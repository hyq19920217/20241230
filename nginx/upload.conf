# 上传文件的临时目录配置
location /tmp {
    deny all;
    return 403;
}

# PHP 文件处理配置
location ~ \.php$ {
    # FastCGI 配置
    fastcgi_pass   unix:/var/opt/remi/php81/run/php-fpm/www.sock;
    fastcgi_index  index.php;
    fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
    include        fastcgi_params;
    
    # 文件上传相关配置
    client_max_body_size 20M;
    client_body_buffer_size 128k;
    
    # FastCGI 缓冲配置
    fastcgi_buffers 16 16k;
    fastcgi_buffer_size 32k;
    
    # 超时设置
    fastcgi_connect_timeout 300;
    fastcgi_send_timeout 300;
    fastcgi_read_timeout 300;
    
    # 错误处理
    fastcgi_intercept_errors on;
    
    # 增加请求体缓冲
    client_body_buffer_size 128k;
    client_body_temp_path /usr/share/nginx/html/tmp;
}

# 禁止访问敏感文件
location ~ /\. {
    deny all;
    access_log off;
    log_not_found off;
}

location ~ composer\.(json|lock)$ {
    deny all;
    access_log off;
    log_not_found off;
}

# 禁止访问 vendor 目录
location /vendor {
    deny all;
    return 403;
}

# 禁止访问 db 目录
location /db {
    deny all;
    return 403;
} 